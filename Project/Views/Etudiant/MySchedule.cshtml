@model List<Project.Models.EmploiDuTemps>

@{
    ViewData["Title"] = "Mon Emploi du Temps";
    var days = new List<string> { "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi" };

    // --- HELPER : Convertir Anglais/Enum vers Français ---
    string NormalizeDay(string dbDay)
    {
        if (string.IsNullOrEmpty(dbDay)) return "";
        var d = dbDay.Trim().ToLower();
        if (d.Contains("mon") || d.Contains("lun")) return "Lundi";
        if (d.Contains("tue") || d.Contains("mar")) return "Mardi";
        if (d.Contains("wed") || d.Contains("mer")) return "Mercredi";
        if (d.Contains("thu") || d.Contains("jeu")) return "Jeudi";
        if (d.Contains("fri") || d.Contains("ven")) return "Vendredi";
        if (d.Contains("sat") || d.Contains("sam")) return "Samedi";
        return dbDay;
    }
}

<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-dark"><i class="fas fa-user-graduate me-2 text-primary"></i>Mon Planning</h2>
            <p class="text-muted">Vue détaillée heure par heure.</p>
        </div>
    </div>

    <div class="card shadow border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-bordered text-center align-middle mb-0" style="min-width: 900px;">
                    <thead class="bg-dark text-white">
                        <tr>
                            <th style="width: 100px;" class="py-3 text-uppercase small">Heure</th>
                            @foreach (var day in days)
                            {
                                <th style="width: 15%;" class="py-3 text-uppercase small fw-bold">@day</th>
                            }
                        </tr>
                    </thead>

                    <tbody>
                        @for (int hour = 8; hour < 18; hour++)
                        {
                            // Définition de la plage actuelle (ex: 8:00 - 9:00)
                            TimeSpan slotStart = new TimeSpan(hour, 0, 0);
                            TimeSpan slotEnd = new TimeSpan(hour + 1, 0, 0);
                            string displayTime = $"{hour}:00 - {hour + 1}:00";

                            <tr>
                                <td class="bg-light fw-bold text-secondary small">@displayTime</td>

                                @foreach (var day in days)
                                {
                                    // LOGIQUE D'AFFICHAGE "COMME SUR L'IMAGE"
                                    // On cherche un cours qui est ACTIF pendant cette heure-là.
                                    // Condition : Le cours commence AVANT la fin du créneau ET finit APRÈS le début du créneau
                                    var course = Model.FirstOrDefault(c =>
                                    NormalizeDay(c.Jour.ToString()) == day &&
                                    c.HeureDebut < slotEnd &&
                                    c.HeureFin > slotStart
                                    );

                                    <td class="p-1 @(course != null ? "bg-info bg-opacity-10" : "")">
                                        @if (course != null)
                                        {
                                            // Style bleu cyan comme sur votre image
                                            <div class="card border-0 shadow-sm h-100 text-start" style="background-color: #00C0EF; color: white; border-radius: 4px;">
                                                <div class="card-body p-2 position-relative">

                                                    <span class="position-absolute top-0 end-0 me-1 mt-0 text-white-50" style="font-size: 10px;">x</span>

                                                    <div class="fw-bold" style="font-size: 0.9rem;">
                                                        @course.Cours?.Titre
                                                    </div>

                                                    <div class="small text-white-50" style="font-size: 0.75rem;">
                                                        @(course.Enseignant?.Utilisateur?.Nom ?? "Prof.")
                                                    </div>

                                                    <div class="mt-1">
                                                        <span class="badge bg-white text-dark border border-secondary" style="font-size: 0.65rem;">
                                                            @course.HeureDebut.ToString(@"hh\:mm") - @course.HeureFin.ToString(@"hh\:mm")
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </td>
                                }
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>